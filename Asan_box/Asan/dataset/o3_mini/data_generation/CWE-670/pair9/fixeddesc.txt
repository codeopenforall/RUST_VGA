The fix enforces proper control flow by checking the safe_mode flag before allowing untrusted input to influence branch selection. When safe_mode is true, the benign operation (nonsensitive) is always used, regardless of the inputâ€™s parity. This eliminates the vulnerability, ensuring that a sensitive operation is not inadvertently called. Also, removed unsafe pointer arithmetic by using safe indexing.