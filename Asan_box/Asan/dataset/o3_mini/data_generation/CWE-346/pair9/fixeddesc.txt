The fixed version corrects the vulnerability by properly parsing the URL in the Origin header to extract the host name. With the helper function, it removes any potential userinfo (e.g., the part before an '@') and compares the resulting host against the expected value ("trusted.com"). This prevents attackers from bypassing validation using crafted headers. Although an unsafe block is still employed (to mirror the original low‚Äêlevel behavior), the origin is now validated in a secure manner.