In the revised code, a dedicated escaping function (escape_html) safely transforms user-provided input by replacing critical characters such as '<', '>', '&', '"' and '\'' with their HTML entity equivalents. By doing so, the rendered HTML template no longer includes raw, untrusted content, mitigating the risk of XSS attacks. The unsafe block from the original version has been removed from the critical rendering path. The concurrent design remains similar to emulate realistic multi-threaded rendering, ensuring the fix integrates well with typical community idioms.