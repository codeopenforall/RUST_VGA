The revised version eliminates the race condition by replacing unsynchronized memory access with an AtomicBool. The check_then_set method now uses compare_exchange with SeqCst ordering to ensure that the “check-and-set” operation is performed atomically. This guarantees that only one thread can successfully observe and flip the flag from false to true, thereby preventing concurrent threads from erroneously passing the check. The overall structure, including thread spawning and simulated workload delay, remains similar to emulate real-world usage patterns while ensuring correctness.