In this corrected version, a dedicated HTML escaping function (escape_html) sanitizes the user input before it is embedded within the HTML template. This change prevents any injected HTML or JavaScript code (such as <script> tags) from being executed, thereby mitigating the XSS vulnerability. The unsafe block has been removed entirely, ensuring that memory and string operations are handled safely.