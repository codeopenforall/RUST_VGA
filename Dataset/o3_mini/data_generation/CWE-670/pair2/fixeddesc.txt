This corrected version fixes the flawed branch logic by assigning the state properly: when the condition is true, the state becomes Active and returns 100 as intended; when false, it becomes Inactive returning 200. The unsafe blocks are eliminated in favor of a safe, mutex-protected update, ensuring that the contract between input and state transition is maintained even in concurrent scenarios.