The corrected version replaces the unsynchronized UnsafeCell with a Mutexâ€‘protected HashMap to ensure thread safety.
Additionally, the authentication function now returns a generic error message ("Authentication failed: Invalid username or password.") regardless of whether the username does not exist or the password is incorrect.
This uniform error response prevents an attacker from distinguishing among failure cases and thus avoids leaking sensitive state.